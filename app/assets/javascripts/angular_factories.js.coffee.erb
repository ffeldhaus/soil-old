angular.module("soil.factories", []).factory 'checkForNewRounds', ($resource, $timeout, $filter, $log) ->
    rounds = []

    scope = null

    setScope = (s) ->
        scope = s

    query = ->
        $log.debug 'In check Round'
        $resource('/games/:game_id/players/:player_id/rounds/',
            game_id: scope.game.id
            player_id: scope.player.id
        ).query (r) ->
            $log.debug 'In query Round'
            if r.length > rounds.length and rounds.length > 0
                $log.debug 'New round'
                scope.getGame(scope.game.id)
            $log.debug 'Old round' if r.length <= rounds.length
            rounds = $filter('orderBy')(r, 'number')
            $log.debug rounds
            $timeout query, 1000

    setScope: setScope,
    query: query