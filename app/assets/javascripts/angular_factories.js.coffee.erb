angular.module("soil.factories", []).factory 'checkForNewRounds', ($resource, $timeout, $filter, $log) ->
    rounds = []

    scope = null

    setScope = (s) ->
        scope = s

    query = ->
        $resource('/games/:game_id/players/:player_id/rounds/',
            game_id: scope.game.id
            player_id: scope.player.id
        ).query (r) ->
            if r.length > rounds.length and rounds.length > 0
                scope.getGame(scope.game.id)
            $log.debug 'Old round' if r.length <= rounds.length
            rounds = $filter('orderBy')(r, 'number')
            $timeout query, 2000

    setScope: setScope,
    query: query