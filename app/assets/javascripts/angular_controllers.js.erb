'use strict';

/* Controllers */

function SoilCtrl($scope, $location, $dialog, $resource, $log, $timeout) {

    $scope.rounds = [];

    var Groups = $resource('/groups/:group_id', {group_id: '@id'});
    var Rounds = $resource('/rounds/:round_id', {round_id: '@id'}, { update: {method: 'PUT'}});

    $scope.getGroup = function (group) {
        $scope.group = Groups.get({group_id: group}, function () {
            $scope.currentRound = $scope.group.rounds[$scope.group.rounds.length - 1].number;
            $scope.getRound($scope.group.rounds.length);
            if ($scope.group.wait_for_other_groups) $scope.wait_for_other_groups();
        });
    }

    $scope.getRound = function (round) {
        if (!$scope.rounds[round-1]) $scope.rounds[round - 1] = Rounds.get({round_id: $scope.group.rounds[round - 1].id});
    };

    $scope.wait_for_other_groups = function () {
        var title = 'Auf andere Gruppen warten';

        $dialog.messageBox(title)
                .open()
                .then(function (result) {
                    $log.info('Waiting for other groups');
                });
    }

    $scope.percentages = ['0%', '10%', '20%', '30%', '40%', '50%'];

    $scope.endRound = function () {
        $scope.test = $location.url()
        if ($location.url() == '/endRound') {
            $scope.endRoundAcknowledgement()
        }
        ;
    }

    $scope.endRoundAcknowledgement = function () {
        var title = 'Runde beenden';
        var msg = 'Soll die Runde wirklich beendet und die Angaben abgeschickt werden?';
        var btns = [
            {result: 'cancel', label: 'Abbrechen'},
            {result: 'send', label: 'Runde beenden', cssClass: 'btn-primary'}
        ];

        $dialog.messageBox(title, msg, btns)
                .open()
                .then(function (result) {
                    $scope.rounds[$scope.rounds.length - 1].$update();
                    $scope.wait_for_other_groups();
                });
    }
}

function FieldCtrl($scope) {
}

// the dialog is injected in the specified controller
function selectPlantationCtrl($scope, dialog) {
    $scope.plantations = [
        'Ackerbohne', 'Gerste', 'Hafer', 'Kartoffel', 'Mais', 'Roggen', 'Weizen', 'Zuckerruebe', 'Tier', 'Brachland'
    ];

    $scope.click = function (plantation) {
        dialog.close(plantation);
    }
}

function FinanceCtrl($scope) {
    $scope.groups = [
        {name: "Gruppe 1", decision: {machines: '0%', organic: true, fertilize: true, pesticide: true, organisms: true}, overview: {machines: '120%', animals: 0, organic: true, weather: 'normal', vermin: 'keine'}, seedcapital: '20000', expenses_seeds_fieldbean: '0', expenses_seeds_barley: '0', expenses_seeds_oat: '0', expenses_seeds_potatoes: '0', expenses_seeds_corn: '0', expenses_seeds_rye: '0', expenses_seeds_wheat: '0', expenses_seeds_beet: '0'},
        {name: "Gruppe 2", decision_machines: '0%', decision_organic: true, decision_fertilize: true, decision_pesticide: true, decision_organisms: true, overview_machines: '120%', overview_animals: 0, overview_organic: true, overview_weather: 'normal', overview_vermin: 'keine'},
        {name: "Gruppe 3", decision_machines: '0%', decision_organic: true, decision_fertilize: true, decision_pesticide: true, decision_organisms: true, overview_machines: '120%', overview_animals: 0, overview_organic: true, overview_weather: 'normal', overview_vermin: 'keine'},
        {name: "Gruppe 4", decision_machines: '0%', decision_organic: true, decision_fertilize: true, decision_pesticide: true, decision_organisms: true, overview_machines: '120%', overview_animals: 0, overview_organic: true, overview_weather: 'normal', overview_vermin: 'keine'},
        {name: "Gruppe 5", decision_machines: '0%', decision_organic: true, decision_fertilize: true, decision_pesticide: true, decision_organisms: true, overview_machines: '120%', overview_animals: 0, overview_organic: true, overview_weather: 'normal', overview_vermin: 'keine'},
        {name: "Gruppe 6", decision_machines: '0%', decision_organic: true, decision_fertilize: true, decision_pesticide: true, decision_organisms: true, overview_machines: '120%', overview_animals: 0, overview_organic: true, overview_weather: 'normal', overview_vermin: 'keine'}

    ];
}

function EndRoundCtrl($scope) {
}